#!/bin/sh

query=$(printf '%s' "$*" | tr ' ' '+' )
movie=$(curl -s https://1337x.wtf/search/$query/1/ | grep -Eo "torrent\/[0-9]{7}\/[a-zA-Z0-9?%-]*/" | dmenu -i -l 20)
magnet=$(curl -s https://1337x.wtf/$movie | grep -Po "magnet:\?xt=urn:btih:[a-zA-Z0-9]*" | head -n 1)
choice=$(printf "Stream\nDownload" | dmenu )
[ $choice = Stream ] && webtorrent "$magnet" --mpv & notify-send "Enjoy Watching"
[ $choice = Download ] && transmission-remote -a "$magnet"
